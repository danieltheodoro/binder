#!/bin/bash
set -eux

# Bash
python3 -m bash_kernel.install

# Go (gophernotes)
echo "Instalando e registrando kernel de Go (gophernotes)..."
git clone --depth=1 https://github.com/gopherdata/gophernotes.git /tmp/gophernotes
cd /tmp/gophernotes
go install
mkdir -p ~/.local/share/jupyter/kernels/gophernotes
cp -r kernel/* ~/.local/share/jupyter/kernels/gophernotes
cd -


# R já vem configurado pelo conda + r-irkernel

# Node.js / JavaScript
echo "Instalando kernel de JavaScript (IJavascript)..."
npm install -g ijavascript
ijsinstall --install=local

echo "Instalando kernel do Haskell..."
apt-get update && apt-get install -y libtinfo-dev libsqlite3-dev libgmp-dev zlib1g-dev

# Instala o stack diretamente sem sudo
curl -sSL https://get.haskellstack.org/ | sh -s - -d /usr/local/bin

# Continua a instalação normalmente
git clone https://github.com/gibiansky/IHaskell.git /tmp/IHaskell
cd /tmp/IHaskell
stack install ihaskell
stack exec -- ihaskell install --prefix=/usr/local/share/jupyter/kernels
cd -

# Corrigindo permissões de kernels (se necessário)
chmod -R 755 ~/.local/share/jupyter/kernels

echo "Registrando kernel do Julia..."
julia -e 'import Pkg; Pkg.add("IJulia"); using IJulia; installkernel("Julia")'

echo "Registrando kernel do Octave..."
python3 -m pip install --upgrade --force-reinstall octave_kernel

#!/bin/bash
set -eux

# Bash
python3 -m bash_kernel.install

# Go (gophernotes)
echo "Instalando e registrando kernel de Go (gophernotes)..."
git clone --depth=1 https://github.com/gopherdata/gophernotes.git /tmp/gophernotes
cd /tmp/gophernotes
go install
mkdir -p ~/.local/share/jupyter/kernels/gophernotes
cp -r kernel/* ~/.local/share/jupyter/kernels/gophernotes
cd -

# Java (IJava kernel)
echo "Instalando IJava kernel..."
git clone https://github.com/SpencerPark/IJava.git /tmp/IJava
cd /tmp/IJava
./gradlew installKernel --args="--user"
cd -

# R já vem configurado pelo conda + r-irkernel

# Node.js / JavaScript
echo "Instalando kernel de JavaScript (IJavascript)..."
npm install -g ijavascript
ijsinstall --install=local

echo "Instalando kernel do Haskell..."
apt-get update && apt-get install -y libtinfo-dev libsqlite3-dev zlib1g-dev
curl -sSL https://get.haskellstack.org/ | sh
stack install ihaskell
ihaskell install --prefix=$(jupyter --data-dir)

echo "Instalando kernel do Haskell..."
apt-get update && apt-get install -y libtinfo-dev libsqlite3-dev zlib1g-dev
curl -sSL https://get.haskellstack.org/ | sh
stack install ihaskell
ihaskell install --prefix=$(jupyter --data-dir)

# Corrigindo permissões de kernels (se necessário)
chmod -R 755 ~/.local/share/jupyter/kernels

echo "Registrando kernel do Julia..."
julia -e 'import Pkg; Pkg.add("IJulia"); using IJulia; installkernel("Julia")'

echo "Registrando kernel do Octave..."
python3 -m pip install --upgrade --force-reinstall octave_kernel

# Abaixo: espaço reservado para kernels extras que não têm suporte oficial Binder ou precisam de workarounds
# echo "Instalando kernel de Haskell / Swift / Kotlin / etc... (manual/custom build necessário)"
